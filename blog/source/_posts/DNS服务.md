---
title: DNS服务
date: 2018-01-30 14:46:25
tags:
---
### DNS（Domain Name Service）:域名解析服务

###### 摘要：
该篇主要讲解DNS域名解析服务的原理以及作用，介绍了域名查询功能中正向解析与反向解析的作用，并通过实验的方式演示了如何在DNS主服务器上部署正、反解析工作模式，以便让更深刻体会到DNS域名查询的便利以及强大。

<!---more--->
##### DNS域名解析服务
DNS(Domain Name System，域名系统)。这是一项用于管理和解析域名与IP地址对应关系的技术，简单来说，就是能够接受用户输入的域名或IP地址，然后自动查找与之匹配（或者说具有映射关系）的IP地址或域名，即将域名解析为IP地址（正向解析），或将IP地址解析为域名（反向解析）。这样一来，我们只需要在浏览器中输入域名就能打开想要访问的网站了。DNS域名解析技术的正向解析也是我们最常使用的一种工作模式。
鉴于互联网中的域名和IP地址对应关系数据库太过庞大，DNS域名解析服务采用了类似目录树的层次结构来记录域名与IP地址之间的对应关系，从而形成了一个分布式的数据库系统,如下图：
![](/assets/img/dns结构.png)

TLD:（顶级域有三类），根下的顶级域由根授权根下各组织进行管理
```
组织域：.com .org .net .cc
国家域: .cn .tw .hk .iq .ir .jp
反向域(将IP转换成主机名):
```

##### 一个域名的查询过程
###### 一些名词解释
```
FQDN：Full Qualified  Domain Name 完全限定域名 如：www.qxx666.com,也叫主机名
dns：名称解析是作为一个名称转换的数据库，将FQDN<--->IP
stub resolver:名称解析器，当需要名称解析时，本地主机会调用该系统软件进行名称解析，该软件会先查hosts文件，如没查到会查询DNS服务。

```
DNS域名解析服务采用分布式的数据结构来存放海量的“区域数据”信息，在执行用户发起的域名查询请求时，具有递归查询和迭代查询两种方式。所谓递归查询，是指DNS服务器在收到用户发起的请求时，必须向用户返回一个准确的查询结果。如果DNS服务器本地没有存储与之对应的信息，则该服务器需要询问其他服务器，并将返回的查询结果提交给用户。而迭代查询则是指，DNS服务器在收到用户发起的请求时，并不直接回复查询结果，而是告诉另一台DNS服务器的地址，用户再向这台DNS服务器提交请求，这样依次反复，直到返回查询结果。

以本机查询www.qxx.com为例，说明其主机查询过程：
![](/assets/img/dns查询过程.png)

````
hosts文件格式：
IPADDR    FQDN    Ailases
````
当用户向网络指定的DNS服务器发起一个域名请求时，通常情况下会有本地由此DNS服务器向上级的DNS服务器发送迭代查询请求；如果该DNS服务器没有要查询的信息，则会进一步向上级DNS服务器发送迭代查询请求，直到获得准确的查询结果为止。其中最高级、最权威的根DNS服务器总共有13台，分布在世界各地，其管理单位、具体的地理位置，以及IP地址如下表所示。
![](/assets/img/各地域名服务器.png)

#### Bind服务介绍和安装
BIND（Berkeley Internet Name Domain，伯克利因特网名称域）服务是全球范围内使用最广泛、最安全可靠且高效的域名解析服务程序。DNS域名解析服务作为互联网基础设施服务，其责任之重可想而知，因此建议大家在生产环境中安装部署bind服务程序时加上chroot（俗称牢笼机制）扩展包，以便有效地限制bind服务程序仅能对自身的配置文件进行操作，以确保整个服务器的安全。

<font color=#ff00>cnetos上安装bind服务
```
yum install bind-chroot
```
bind服务程序的配置并不简单，因为要想为用户提供健全的DNS查询服务，要在本地保存相关的域名数据库，而如果把所有域名和IP地址的对应关系都写入到某个配置文件中，估计要有上千万条的参数，这样既不利于程序的执行效率，也不方便日后的修改和维护。因此在bind服务程序中有下面这三个比较关键的文件。

1、<font color=#00888>主配置文件（/etc/named.conf）</font>：只有58行，而且在去除注释信息和空行之后，实际有效的参数仅有30行左右，这些参数用来定义bind服务程序的运行。

2、<font color=#00888>区域配置文件（/etc/named.rfc1912.zones）</font>：用来保存域名和IP地址对应关系的所在位置。类似于图书的目录，对应着每个域和相应IP地址所在的具体位置，当需要查看或修改时，可根据这个位置找到相关文件

3、<font color=#00888>数据配置文件目录（/var/named）</font>：该目录用来保存域名和IP地址真实对应关系的数据配置文件。
