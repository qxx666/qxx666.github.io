---
title: 日志服务
date: 2018-06-07 18:00:07
tags:
---

#### 摘要

本文对系统的日志服务做简要的说明，主要针对syslogd这个服务进行介绍


<!---more--->

### 日志服务
- syslogd centos提供了这个服务来统一管理日志文件，系统服务只要将信息丢给这个服务，他就会分门别类的将各信息放置到相应的日志文件中
  syslog的配置文件：/etc/syslog.conf

- klogd：专门记录内核信息的日志文件服务

  - 日志文件内容一般格式

    1. 事件发生的日期与时间
    2. 发生此事的主机名
    3. 启动此事的服务名称或函数名称
    4. 该信息的实际数据内容

- 信息等级
  1. info 仅是一些基本信息的说明而已
  2. notice 除了info外还需要注意的一些基本信息
  3. warning 警示信息，可能有问题，但不至于影响服务的运行
  4. err 一些重大错误信息，通过该日志可以知道服务无法启动的原因
  5. crit 比err还要严重的信息想
  6. alert 警告，已经很有问题的等级
  7. emerg “疼痛等级”，指系统要死机状态

- 几个符号的意思

 “。” 代表后面还要高的等级（包过该等级）都被记录下来，例如mail.info
 “。=” 代表需要的等级就是等号接的等级
 “。！”代表不等于，即除了该等级外的其他等级都记录

 例子：将买了相关数据写入/var/log/maillog当中

 >vim /etc/syslog.conf

 >mail.info  &nbsp;&nbsp;&nbsp; /var/log/maillog

  除此之外还有debug和none两个等级，当要做一些错误检测或者忽略某些服务信息时，就用这两个

#### linux常见的日志文件
  - /var/log/cron：crontab调度日志
  - /var/log/dmesg：记录系统在开机时内核检测过程产生的信息
  - /var/log/lastlog：记录系统上面所有账号最近一次登录系统时的信息
  - /var/log/maillog或者/var/log/mail/* ：记录邮件往来信息
  - /var/log/messages：记录系统发生的错误信息
  - /var/log/secure：输入账号密码，在用户登入时的一些信息
  - /var/log/wtmp,/var/log/failog：记录正确或错误，登录系统用户的账号信息
  - /var/log/httpd/*,/var/log/news/*,/var/log/samba/*：一些网络服务所产生的日志

#### 日志文件的安全性
- syslog日志文件只要别编辑过就无法记录信息，得重新启动syslog服务
>chattr +a /var/log/message
加了这个属性后，message日志文件只能被增加，不能被删除，知道root以chattr -a /var/log/message取消这个属性参数，才能被删除和移动
#### 日志文件服务器的设置
可以将多个服务器中的日志信息发送到某台主机上，以便集中查看和管理

#### 日志文件的轮替
logrotate是在规定的时间到了之后来进行日志文件的轮替，所以这个logrotate程序当然挂在cron下面进行，在/etc/cron.daily/logrotate就记录了每天进行的日志轮替的行为

logrotate程序的参数配置文件

- /etc/logrotate.conf :主要参数文件
- /etc/logrotate.d/

一个例子：
  对于加了+a标签的/var/log/admin.log文件做如下条件的轮替
  1. 日志文件轮替一个月进行一次
  2. 若文件大于10M，则主动轮替，不用考虑一个月的期限
  3. 保存五分备份
  4. 备份压缩

>chattr +a /var/log/admin.log

>vim /var/logrotate.d/admin

/var/log/admin.log{
  mouthly

  size=10M
  rotate 5

  comnpress

  sharedscripts

  prerotate

    /usr/bin/chattr -a /var/log/admin.log

  endscripts

  sharescripts

  prerotate

    /usr/bin/kiallall -HUP syslogd

    /usr/bin/chattr +a /var/log/admin.log

  endscripts
}


### 分析日志文件

默认提供logwatch
